#include<stdio.h>
#include<iostream>
#include <iomanip>
using namespace std;
int sbox[256] = {
112,130, 44,236,179, 39,192,229,228,133, 87, 53,234, 12,174, 65,
 35,239,107,147, 69, 25,165, 33,237, 14, 79, 78, 29,101,146,189,
134,184,175,143,124,235, 31,206, 62, 48,220, 95, 94,197, 11, 26,
166,225, 57,202,213, 71, 93, 61,217,  1, 90,214, 81, 86,108, 77,
139, 13,154,102,251,204,176, 45,116, 18, 43, 32,240,177,132,153,
223, 76,203,194, 52,126,118,  5,109,183,169, 49,209, 23,  4,215,
 20, 88, 58, 97,222, 27, 17, 28, 50, 15,156, 22, 83, 24,242, 34,
254, 68,207,178,195,181,122,145, 36,  8,232,168, 96,252,105, 80,
170,208,160,125,161,137, 98,151, 84, 91, 30,149,224,255,100,210,
 16,196,  0, 72,163,247,117,219,138,  3,230,218,  9, 63,221,148,
135, 92,131,  2,205, 74,144, 51,115,103,246,243,157,127,191,226,
 82,155,216, 38,200, 55,198, 59,129,150,111, 75, 19,190, 99, 46,
233,121,167,140,159,110,188,142, 41,245,249,182, 47,253,180, 89,
120,152,  6,106,231, 70,113,186,212, 37,171, 66,136,162,141,250,
114,  7,185, 85,248,238,172, 10, 54, 73, 42,104, 60, 56,241,164,
 64, 40,211,123,187,201, 67,193, 21,227,173,244,119,199,128,158 
};

int t[60] = { 0 };

////Toffoli depth = 3
void f_1(int* x)
{
	t[20] = 0;
	t[20] = 0;
	t[22] = 0;
	t[24] = 0;
	t[26] = 0;
	int a = 0;

x[2] = x[2] ^ x[1];
x[2] = x[2] ^ 1;
x[5] = x[5] ^ x[6];
x[5] = x[5] ^ x[1];
x[5] = x[5] ^ x[0];
x[7] = x[7] ^ x[4];
x[7] = x[7] ^ x[1];
x[7] = x[7] ^ x[0];
x[3] = x[3] ^ x[5];
x[3] = x[3] ^ x[7];
x[3] = x[3] ^ x[2];
x[6] = x[6] ^ x[5];
x[6] = x[6] ^ x[4];
x[6] = x[6] ^ x[3];
x[6] = x[6] ^ x[2];
x[6] = x[6] ^ x[1];
x[6] = x[6] ^ 1;
x[0] = x[0] ^ x[5];
x[0] = x[0] ^ 1;
x[4] = x[4] ^ x[1];
x[1] = x[1] ^ x[5];
x[1] = x[1] ^ x[3];
x[1] = x[1] ^ x[6];
t[20] = t[20] ^ x[2] & x[5];
t[22] = t[22] ^ x[7] & x[3];
t[26] = t[26] ^ x[6] & x[0];
t[24] = t[24] ^ x[4] & x[1];
t[24] = t[24] ^ t[26];
t[20] = t[20] ^ t[22];
t[20] = t[20] ^ t[24]; 
x[6] = x[6] ^ x[4];
x[1] = x[1] ^ x[0];
x[7] = x[7] ^ x[4];
x[0] = x[0] ^ x[1];
x[0] = x[0] ^ x[3];
x[2] = x[2] ^ x[6];
x[5] = x[5] ^ x[1];
x[4] = x[4] ^ x[6];
x[4] = x[4] ^ x[7];
x[4] = x[4] ^ x[2];
x[3] = x[3] ^ x[5];
x[3] = x[3] ^ x[1];
t[26] = t[26] ^ x[6] & x[1];
a    = a ^ x[7] & x[0];
t[24] = t[24] ^ x[2] & x[5];
t[22] = t[22] ^ x[4] & x[3];
t[22] = t[22] ^ t[26];
t[24] = t[24] ^ a;
t[26] = t[26] ^ a;
x[2] = x[2] ^ x[7];
x[5] = x[5] ^ x[0];
a = a ^ x[7] & x[0];
t[26] = t[26] ^ x[2] & x[5];  
x[4] = x[4] ^ x[5];
x[4] = x[4] ^ x[7];
x[4] = x[4] ^ x[3];
x[4] = x[4] ^ x[2];
x[4] = x[4] ^ x[0];
t[20] = t[20] ^ x[4];
x[6] = x[6] ^ x[5];
x[6] = x[6] ^ x[2];
x[6] = x[6] ^ x[1];
t[22] = t[22] ^ x[6];
x[4] = x[4] ^ x[5];
x[4] = x[4] ^ x[7];
x[4] = x[4] ^ x[2];
x[4] = x[4] ^ x[0];
t[24] = t[24] ^ x[4];
x[6] = x[6] ^ x[7];
x[6] = x[6] ^ x[0];
t[26] = t[26] ^ x[6];
}

////Toffoli depth = 6
void S_4()
{
int a = 0; 
////////4-bit S-box:(20, 22, 24, 26) -> (31, 35, 39, 42): "062493d51ec78abf"///////////////////////////////////////
t[22] = t[22] ^ 1;
a = a ^ (t[26] & t[22]);
t[24] = t[24]^ (a & t[20]);
t[26] = t[26] ^ t[24];
t[22] = t[22] ^ 1;
t[22] = t[22] ^ (t[20] & t[24]);
t[24] = t[24] ^ (t[22] & t[26]);
t[20] = t[20] ^ t[22];
t[22] = t[22] ^ (t[20] & t[24]);
t[24] = t[24] ^ t[26];
t[26] = t[26] ^ (t[22] & t[24]);

// t[31] = t[22];
// t[35] = t[24];
// t[39] = t[26];
// t[42] = t[20];
///////////////////////////////////////////////////
}

////Toffoli depth = 6
void f_2(int * x, int* s)
{
	for (int i = 0; i < 8; i++)
	{
		s[i] = 0;
	}



//for the case that the initial values of the S-box outputs are not 0s:

s[0] = s[0] ^ s[1];
s[3] = s[3] ^ s[1];
s[2] = s[2] ^ s[7];
s[5] = s[5] ^ s[6];
s[7] = s[7] ^ s[4];
s[4] = s[4] ^ s[6];
s[1] = s[1] ^ s[4];
s[2] = s[2] ^ s[4];
s[2] = s[2] ^ s[3];
s[3] = s[3] ^ s[7];
s[3] = s[3] ^ s[5];
s[7] = s[7] ^ s[0];

////////////////////////



t[20] = t[20] ^ t[22];
t[26] = t[26] ^ t[24];
x[1] = x[1] ^ x[5];
x[1] = x[1] ^ x[4];
x[1] = x[1] ^ x[3];
x[1] = x[1] ^ x[6];
x[1] = x[1] ^ x[0];
x[4] = x[4] ^ x[3];
////Toffoli depth = 1
	s[6] = s[6] ^ t[22] & x[2];
	s[7] = s[7] ^ t[20] & x[0];
	s[1] = s[1] ^ t[26] & x[1];
    s[4] = s[4] ^ t[24] & x[4];

t[20] = t[22] ^ t[20];
t[24] = t[24] ^ t[22];
x[7] = x[7] ^ x[2];
x[3] = x[3] ^ x[5];
////Toffoli depth = 2
    s[6] = s[6] ^ t[20] & x[7];
    s[0] = s[0] ^ t[22] & x[5];
    s[2] = s[2] ^ t[26] & x[1];
    s[5] = s[5] ^ t[24] & x[3];

	s[7] = s[7] ^ s[0];
	s[3] = s[3] ^ s[5];

t[22] = t[22] ^ t[24];
t[26] = t[26] ^ t[22];
t[20] = t[20] ^ t[24];
t[20] = t[20] ^ t[26];
t[24] = t[24] ^ t[20];
x[1] = x[1] ^ x[4];
x[1] = x[1] ^ x[6];
x[0] = x[0] ^ x[3];
x[0] = x[0] ^ x[1];
x[0] = x[0] ^ x[5];
x[6] = x[6] ^ x[7];
x[6] = x[6] ^ x[1];
////Toffoli depth = 3
    s[6] = s[6] ^ t[22] & x[4];
    s[0] = s[0] ^ t[26] & x[1];
    s[5] = s[5] ^ t[20] & x[0];
    s[4] = s[4] ^ t[24] & x[6];
	s[3] = s[3] ^ s[7];
t[26] = t[26] ^ t[22];
t[20] = t[24] ^ t[20];
x[5] = x[5] ^ x[3];
x[1] = x[1] ^ x[5];
x[4] = x[4] ^ x[2];
x[0] = x[0] ^ x[3];
////Toffoli depth = 4
    s[0] = s[0] ^ t[22] & x[5];
    s[7] = s[7] ^ t[26] & x[1];
    s[2] = s[2] ^ t[20] & x[4];
    s[3] = s[3] ^ t[24] & x[0];
	s[2] = s[2] ^ s[3];
	s[2] = s[2] ^ s[4];
t[20] = t[24] ^ t[20];
t[26] = t[26] ^ t[22];
t[24] = t[26] ^ t[24];
x[6] = x[6] ^ x[4];
x[1] = x[1] ^ x[5];
////Toffoli depth = 5
    s[4] = s[4] ^ t[20] & x[6];
    s[7] = s[7] ^ t[22] & x[5];
    s[5] = s[5] ^ t[26] & x[1];
    s[1] = s[1] ^ t[24] & x[7]; 
	s[1] = s[1] ^ s[4];
	s[4] = s[4] ^ s[6];  

t[22] = t[26] ^ t[22];
t[20] = t[22] ^ t[20];
x[4] = x[4] ^ x[6];
x[4] = x[4] ^ x[7];
x[0] = x[0] ^ x[1];
x[5] = x[5] ^ x[1];
x[2] = x[2] ^ x[7];
////Toffoli depth = 6
    s[6] = s[6] ^ t[26] & x[4]; 
    s[0] = s[0] ^ t[24] & x[0];
    s[5] = s[5] ^ t[22] & x[5];
    s[1] = s[1] ^ t[20] & x[2];

	s[7] = s[7] ^ s[4];  
	s[5] = s[5] ^ s[6]; 
	s[2] = s[2] ^ s[7];  
	s[3] = s[3] ^ s[1]; 
	s[0] = s[0] ^ s[1];

	s[1] ^= 1;
	s[2] ^= 1;
	s[4] ^= 1;
	s[5] ^= 1;
	s[6] ^= 1;
}


void camellia_forward_sbox(int* x, int* s)
{
	f_1(x);
	S_4();
	f_2(x, s);
}

int main()
{
	for (int i = 0; i < 256; i++)
	{  //i = 76543210
		int in[8] = { 0 };
		int out[8] = { 0 };

		for(int j = 0; j < 8; j++) in[j] = ((i >> j) & 1);

		camellia_forward_sbox(in, out);

		int sum = out[0] * 128 + out[1] * 64 + out[2] * 32 + out[3] * 16 + out[4] * 8 + out[5] * 4 + out[6] * 2 + out[7];
		if ((i != 0) && ((i % 16 == 0)))
		{
			cout << endl;
		}
		if (sum == sbox[i])
		{
			cout << "0  ";
		}
		else if (sum != sbox[i])
		{
			cout << "1  ";
		}
	}

	cout << endl;
	return 0;
}

/*
NCT-base circuit with 5 ancilla qubits:
     
     #Toffoli | #CNOT | #NOT | Toffoli-depth
f_1:    10        58      3        3
S_4:    6          3      2        6
f_2:    24        54      5        6


To reset ancilla qubits,
in the f_2 circuit, 
     # CNOT on s: 12
	 # CNOT on t: 2  (i.e., the in-place implementation of M_t)
	 # CNOT on x: 9  (i.e., the in-place implementation of M_x)

#ancilla qubits = 5:
M_x:
0xd4,
0xc0,
0x21,
0x44,
0x6e,
0x54,
0x48,
0x20

in-place implementation:
x[5] = x[5] ^ x[1]    y[3]
x[3] = x[3] ^ x[5]    y[5]
x[6] = x[6] ^ x[2]
x[6] = x[6] ^ x[4]
x[4] = x[4] ^ x[1]    y[6]
x[1] = x[1] ^ x[0]    y[1]
x[0] = x[0] ^ x[3]    y[0]
x[6] = x[6] ^ x[5]    y[4]
x[7] = x[7] ^ x[2]    y[2]


M_t:
2
a
5
1

in-place implementation:

x[1] = x[1] ^ x[3]    y[2]
x[0] = x[0] ^ x[2]    y[1]


Totally, the NCT-base circuit with 5 ancilla qubits:
     
     #Toffoli | #CNOT | #NOT | Toffoli-depth
f_1:    10*2      58*2   3*2       3*2
S_4:    6*2       3*2    2*2       6*2
f_2:    24        54      5        6
reverse_f_2:      2+9
outputs value
are not 0s:        12
----------------------------------------------
		56         199   15        24
*/